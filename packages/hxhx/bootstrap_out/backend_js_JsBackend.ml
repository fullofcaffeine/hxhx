# 1 "backend_js_JsBackend.ml"
(* Generated by reflaxe.ocaml (WIP) *)
(* Haxe type: backend.js.JsBackend *)

let __reflaxe_ocaml__ = ()

type t = { __hx_type : Obj.t; mutable delegate : Backend_TargetCoreBackend.t; id : Obj.t -> unit -> string; describe : Obj.t -> unit -> string; capabilities : Obj.t -> unit -> Obj.t; emit : Obj.t -> Obj.t -> Backend_BackendContext.t -> Backend_EmitResult.t; registrations : Obj.t -> unit -> Obj.t HxArray.t }

let id__impl = fun (self : t) () -> let __obj_2 = self.delegate in __obj_2.id (Obj.magic __obj_2) ()

let describe__impl = fun (self : t) () -> let __obj_3 = self.delegate in __obj_3.describe (Obj.magic __obj_3) ()

let capabilities__impl = fun (self : t) () -> let __obj_4 = self.delegate in __obj_4.capabilities (Obj.magic __obj_4) ()

let emit__impl = fun (self : t) (program : Obj.t) (context : Backend_BackendContext.t) -> let __obj_5 = self.delegate in __obj_5.emit (Obj.magic __obj_5) program context

let capabilitiesStatic = fun () -> let __anon_12 = HxAnon.create () in (
  ignore (HxAnon.set __anon_12 "supportsNoEmit" (Obj.repr true));
  ignore (HxAnon.set __anon_12 "supportsBuildExecutable" (Obj.repr false));
  ignore (HxAnon.set __anon_12 "supportsCustomOutputFile" (Obj.repr true));
  __anon_12
)

let descriptor = fun () -> let __anon_6 = HxAnon.create () in (
  ignore (HxAnon.set __anon_6 "id" (Obj.repr "js-native"));
  ignore (HxAnon.set __anon_6 "implId" (Obj.repr "builtin/js-native"));
  ignore (HxAnon.set __anon_6 "abiVersion" (Obj.repr 1));
  ignore (HxAnon.set __anon_6 "priority" (Obj.repr 100));
  ignore (HxAnon.set __anon_6 "description" (Obj.repr "Native JS backend (MVP)"));
  ignore (HxAnon.set __anon_6 "capabilities" (Obj.repr (capabilitiesStatic ())));
  ignore (HxAnon.set __anon_6 "requires" (Obj.repr (let __anon_7 = HxAnon.create () in (
    ignore (HxAnon.set __anon_7 "genIrVersion" (Obj.repr 1));
    ignore (HxAnon.set __anon_7 "macroApiVersion" (Obj.repr 1));
    ignore (HxAnon.set __anon_7 "hostCaps" (Obj.repr (let __arr_8 = HxArray.create () in (
      ignore (HxArray.push __arr_8 "filesystem");
      ignore (HxArray.push __arr_8 "process");
      ignore (HxArray.push __arr_8 "node");
      __arr_8
    ))));
    __anon_7
  ))));
  __anon_6
)

let providerDescriptor = fun () -> let __anon_9 = HxAnon.create () in (
  ignore (HxAnon.set __anon_9 "id" (Obj.repr "js-native"));
  ignore (HxAnon.set __anon_9 "implId" (Obj.repr "provider/js-native-wrapper"));
  ignore (HxAnon.set __anon_9 "abiVersion" (Obj.repr 1));
  ignore (HxAnon.set __anon_9 "priority" (Obj.repr 200));
  ignore (HxAnon.set __anon_9 "description" (Obj.repr "JS backend provider wrapper (dynamic)"));
  ignore (HxAnon.set __anon_9 "capabilities" (Obj.repr (capabilitiesStatic ())));
  ignore (HxAnon.set __anon_9 "requires" (Obj.repr (let __anon_10 = HxAnon.create () in (
    ignore (HxAnon.set __anon_10 "genIrVersion" (Obj.repr 1));
    ignore (HxAnon.set __anon_10 "macroApiVersion" (Obj.repr 1));
    ignore (HxAnon.set __anon_10 "hostCaps" (Obj.repr (let __arr_11 = HxArray.create () in (
      ignore (HxArray.push __arr_11 "filesystem");
      ignore (HxArray.push __arr_11 "process");
      ignore (HxArray.push __arr_11 "node");
      __arr_11
    ))));
    __anon_10
  ))));
  __anon_9
)

let targetCore = fun () -> Backend_js_JsTargetCore.create ()

let __ctor = fun (self : t) () -> ignore (let core = targetCore () in let __assign_1 = Backend_TargetCoreBackend.create (descriptor ()) (fun program context -> core.emit (Obj.magic core) program context) in (
  self.delegate <- __assign_1;
  __assign_1
))

let emitBridge = fun backend program context -> backend.emit (Obj.magic backend) program context

let providerRegistrations = fun () -> let provided = providerDescriptor () in let __arr_13 = HxArray.create () in (
  ignore (HxArray.push __arr_13 (let __anon_14 = HxAnon.create () in (
    ignore (HxAnon.set __anon_14 "descriptor" (Obj.repr provided));
    ignore (HxAnon.set __anon_14 "create" (Obj.repr (fun () -> let core = targetCore () in Backend_TargetCoreBackend.create provided (fun program context -> core.emit (Obj.magic core) program context))));
    __anon_14
  )));
  __arr_13
)

let registrations__impl = fun (self : t) () -> (
  ignore self;
  providerRegistrations ()
)

let create = fun () -> let self = ({ __hx_type = HxType.class_ "backend.js.JsBackend"; delegate = Obj.magic (); id = (fun o () -> id__impl (Obj.magic o) ()); describe = (fun o () -> describe__impl (Obj.magic o) ()); capabilities = (fun o () -> capabilities__impl (Obj.magic o) ()); emit = (fun o a0 a1 -> emit__impl (Obj.magic o) a0 a1); registrations = (fun o () -> registrations__impl (Obj.magic o) ()) } : t) in (
  ignore (let core = targetCore () in let __assign_1 = Backend_TargetCoreBackend.create (descriptor ()) (fun program context -> core.emit (Obj.magic core) program context) in (
    self.delegate <- __assign_1;
    __assign_1
  ));
  self
)

let __empty = fun () -> ({ __hx_type = HxType.class_ "backend.js.JsBackend"; delegate = Obj.magic (); id = (fun o () -> id__impl (Obj.magic o) ()); describe = (fun o () -> describe__impl (Obj.magic o) ()); capabilities = (fun o () -> capabilities__impl (Obj.magic o) ()); emit = (fun o a0 a1 -> emit__impl (Obj.magic o) a0 a1); registrations = (fun o () -> registrations__impl (Obj.magic o) ()) } : t)